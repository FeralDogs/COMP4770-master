<!DOCTYPE HTML>
<HTML>
<head>
      <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <link rel="stylesheet" type="text/css" href="/css/styles.css">
      <!-- <link href="/styles.css"> -->
      <script type="text/javascript;charset=utf-8" async src="js/inventory.js"></script>
</head>
<script src="js/entity.js"></script>
<script src="js/levelEditor.js"></script>
<script src="js/levelLoad.js"></script>
<script src="js/levelSave.js"></script>
<script src="js/inventory.js"></script>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<body>
<div id="signDiv">
	Username: <input id="signDiv-username" type="text"></input><br>
	Password: <input id="signDiv-password" type="password"></input>
	<button id="signDiv-signIn">Sign In</button>
	<button id="signDiv-signUp">Sign Up</button>
</div>

<div id="gameDiv" style="display:none;">
	<div id="game" style="position:absolute;width:1280px;height:720px">
		<canvas id="ctx" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>
		<canvas id="ctx-ui" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>
	</div>
</div>

<div id="levelEditor" style="display:none;">
	<div id="editor" style="position:absolute;width:1280px;height:720px;">
		<canvas id="ctxLE" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>
		<canvas id="ctx_uiLE" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>

	</div>
      <div id="aSelect1" style ="position: fixed; bottom: 1280; right: 0;">
            <select id="selections";>
                  <option value="p"selected="selected">Player</option>
                  <option value="e">Enemies</option>
                  <option value="f">Platform</option>
            </select>
      </div>
	<div id="backLE" style="display:none;position:absolute;top:750px;">
		<button onclick="backMainMenu()">Back</button>
	</div>
	<div id="save" style ="display:none;position:absolute;top:750px;left:50px">
            <button id="savebutton">Save</button>
	</div>
	<div id="play" style="display:none;position:absolute;top:750px;left:100px;">
		<button id="play">Play</button>
	</div>
</div>

<div id="playerProfile" style ="display:none;">
	 UserName : <input type="text" id="username" value=username>
	 token : <input type="text" id="token" value=token>
	 levelEditorString : <input type="text" id="level" value=saveLevel()>



</div>


<div id="back" style ="display:none;">
      <button onclick="backMainMenu()">Back</button>
</div>




<div id="profileDiv" style ="display:none;">
      <button onclick="showProfile()">Profile</button>
</div>


<!-- <div id="selections" style ="display:none;">
      <select>
            <option value="asset1">asset1</option>
            <option value="asset2">asset2</option>
            <option value="asset3">asset3</option>
      </select>
</div> -->


<div id="mainMenu" style="display:none;">
			<button id="profile">Profile </button>
			<button id="newGame">New Game</button>
			<button id="loadGame">Load Game</button>
                  <button id="levelEditorB">Level Editor</button>

</div>
<!-- All files had the same id
      Will need to connect to database -->
<div id="loadFile" style="display:none;">
      <button id="file">File One</button>
      <button id="file">File Two</button>
      <button id="file">File Three</button>
</div>

<script>
	var username = "";
	var token = "";
	let canvas=document.getElementById('ctx');
      let canvasG=document.getElementById('ctx_uiLE');
	let ctx=canvas.getContext('2d');
	let canvasLE=document.getElementById('ctxLE');
	let ctxLE=canvasLE.getContext('2d');
      let ctx_uiLE = canvasG.getContext('2d');

  let signDivSignIn = document.getElementById('signDiv-signIn');
  let signDivSignUp = document.getElementById('signDiv-signUp');
  let newGame = document.getElementById('newGame');
  let loadGame = document.getElementById('loadGame');
  let levelEditorB = document.getElementById('levelEditorB');
  let loadFile = document.getElementById('loadFile');
  let file = document.getElementById('file');
  let a1 = document.getElementById('selections');


	let save = document.getElementById('save');
	let usernameText=document.getElementById('username');
	let profile=document.getElementById('profile');
	let tokenText=document.getElementById('token');
	let saveLevelText=document.getElementById('level');
	let keyUp=87;
	let keyDown=83;
	let keyRight=68;
	let keyLeft=65;
	let keyPause=80;
	let keyGrapple=32;
	let keyChange=67;
	let W=1280;
	let H=720;
	let screen='sign';
	let count=0;
	let check=true

	moveScreen=MoveScreen(0,0,);


  var Img = {};
  Img.playerLevel = new Image();
  Img.playerLevel.src = "img/player_level.png";
	Img.penLeft=new Image();
	Img.penLeft.src="img/pen_left.png";
	Img.penRight=new Image();
	Img.penRight.src="img/pen_right.png";
	Img.philEnemy=new Image();
	Img.philEnemy.src="img/philEnemy.png";

	//testing collision of rectangles
	testCollisionRects = function(rect1,rect2){
	return rect1.x <= rect2.x+rect2.width
		&& rect2.x <= rect1.x+rect1.width
		&& rect1.y <= rect2.y + rect2.height
		&& rect2.y <= rect1.y + rect1.height;
	}

	//action listeners, logic tbd
	document.onmousedown=function(mouse){
		if(mouse.which==1){
			if (levelEditor.style.display == "none") {
				player.lMouseClick=true;
			}
			else{
				let selection = selections.options[selections.selectedIndex].value;
				mousePos.code=selection;
				console.log(mousePos.code);
				mousePos.draw();
			}
		}
		else{
			player.rMouseClick=true;
		}
	}
	document.onmouseup=function(mouse){
		if(mouse.which==1){
			player.lMouseClick=false;
		}
		else{
			player.rMouseClick=false;
		}
	}
	document.oncontextmenu=function(mouse){
		mouse.preventDefault();
	}
	document.onmousemove=function(mouse){
	let mouseX = mouse.clientX - canvas.getBoundingClientRect().left;
	let mouseY = mouse.clientY - canvas.getBoundingClientRect().top;



      if (screen=='game'||screen=='overworld') {
            mouseX -= W/2;
			mouseY -= H/2;
            player.aimAngle = Math.atan2(mouseY,mouseX) / Math.PI * 180;
      }
      else if(screen=='le'){
            mousePos.x=mouseX-8;
			mousePos.y=mouseY-3;
            // console.log("mouseX: " + mouseX + "mouseY: " + mouseY);
      }

	}
	document.onkeydown=function(event){
		if(screen=='game'||screen=='overworld'){
			if(event.keyCode==keyUp) {
				player.upPress=true;
				}
			else if(event.keyCode==keyDown) {
				player.downPress=true;
				}
			else if(event.keyCode==keyRight){
				player.rightPress=true;
				}
			else if(event.keyCode==keyLeft) {
				player.leftPress=true;
			}
			else if(event.keyCode==keyPause) {
				//add logic to pause
            }
			else if(event.keyCode==keyGrapple) {
				player.grapplePress=true;
            }
			else if(event.keyCode==keyChange){
				if(player.weap==0){
					player.weap=1;
				}
				else{
					player.weap=0;
				}
			}
		}
		else if(screen=='le'){
			if(event.keyCode==keyUp){
				moveScreen.down--;
			}
			else if(event.keyCode==keyDown){
				moveScreen.down++;
			}
			else if(event.keyCode==keyRight){
				moveScreen.right++;
			}
			else if(event.keyCode==keyLeft){
				moveScreen.right--;
			}
		}
	}
	document.onkeyup=function(event){
		if(event.keyCode==keyUp)
			player.upPress=false;
		else if(event.keyCode==keyDown)
			player.downPress=false;
		else if(event.keyCode==keyRight)
			player.rightPress=false;
		else if(event.keyCode==keyLeft)
			player.leftPress=false;
		else if(event.keyCode==keyPause) {
			//add logic to pause
            }
		else if(event.keyCode==keyGrapple)
			player.grapplePress=false;
	}

	//update for in game, logic tbd
	update=function(){
			if(levelEditor.style.display == "none"){
				ctx.clearRect(0, 0, 1280, 720);
			}
			else{
				ctxLE.clearRect(0,0,1280,720);
			}
            player.update();
			Enemy.update();
			Projectile.update();
			Platform.update();
            //console.log("Player (X,Y): " + "(" + player.x + ", " + player.y + ")");
			//console.log("Player aim angle is: "+player.aimAngle);
			//console.log("Grapple key = "+player.grapplePress);
			//console.log("Attack Speed: "+player.atkSpd+" Attack Counter: "+player.atkCnt);
      }

    function valid(userName,pass){
			if (!isEmpty(userName) && !isEmpty(pass) ){
					return true;
				}

			}
	function isEmpty(str) {
		return (!str || 0 === str.length);
	}


	signDivSignUp.onclick = function() {
		user=document.getElementById('signDiv-username').value;
		pass=document.getElementById('signDiv-password').value;

		if (valid(user,pass)){
			var socket = io();
			socket.emit('signUp',{
			username:user, password:pass ,
			});
    	socket.on('accountCreated', function(message){
				console.log(message);
				if (message.accountCreated==true) console.log("account Created");
			});
		}
  }

	signDivSignIn.onclick = function() {
      console.log("signDivSignIn HIT")
			user=document.getElementById('signDiv-username').value;
			pass=document.getElementById('signDiv-password').value;


			let check=true

			if (valid(user,pass && check)){
				check=false;
				var socket = io();
				socket.emit('signIn',{
				username:user, password:pass ,
				});

				socket.on('signedIn', function(message){            //AccountManager
					console.log(message);

					msg=message;
					token = message.token;


					console.log(message.signedIn);
					if (message.signedIn==true){

					username=message.userName;
					token=message.token;
					tokenText.value=token;
					usernameText.value=username;
					let playerName="mario";
					let diffuculty="hard";
					let progress="false"   ; //used for mid-term
					let inventory="1001";


				  saveLevelText.value=saveLevel("john","mario","mission","hard","true","10001",0,0,0,0);

					console.log("welcome  : "  +message.userName  ) ;
					console.log("your token is  :"  +message.token);

					document.getElementById('signDiv-password').value;
					signDiv.style.display = 'none';
					mainMenu.style.display = 'inline-block';


					//playerProfile.style.display = 'inline-block';
					back.style.display = 'inline';
					screen='menu';


				}


				});

				}



	}

	function backMainMenu(){
   console.log("s " + screen);
		if (screen=="menu"){
			mainMenu.style.display = 'none';
			back.style.display = 'none';
			backLE.style.display = 'none';
			playerProfile.style.display = 'none';
			signDiv.style.display = 'inline-block';
		}

		if (screen=="le" || screen =="game"){
			levelEditor.style.display = 'none';
      selections.style.display = 'none';
			loadFile.style.display = 'none';
			gameDiv.style.display = 'none';

			back.style.display = 'none';

			//gameDiv.style.display = 'inline-block';
      mainMenu.style.display = 'inline-block';
			back.style.display = 'inline';
			screen="menu";
		}
			//console.log("count " + count);


	}





	save.onclick=function(){

		let socket=io();
		console.log("save button HIT");
		socket.emit('saveLevel',{
				levels: saveLevel(),

				});

}



	//console.log("string :" + saveLevel(0,0,0,0));

	play.onclick=function(){
		gameDiv.style.display="inline-block";
		levelEditor.style.display = 'none';
		save.style.display = 'none';
		backLE.style.display="none";
		play.style.display="none";
		screen='game';
	}

      newGame.onclick = function() {
        mainMenu.style.display = 'none';
        gameDiv.style.display = 'inline-block';
		screen='game';
		player = Player(190, 620);
		Enemy.generate(0,0,'e');
		Platform.generate(128,128,'f');
            Platform.generate(190,684,'f');
      }

      loadGame.onclick = function() {
            mainMenu.style.display = 'none';
            loadFile.style.display = 'inline-block';
		      	screen='game';
      }

      file.onclick = function () {
            loadFile.style.display = 'none';
            gameDiv.style.display = 'inline-block';
      }

			profile.onclick= function  () {
            playerProfile.style.display = 'inline-block';
						console.log("profile hit");
      }

      levelEditorB.onclick = function() {
      	mainMenu.style.display = 'none';
      	selections.style.display = 'inline';
      	levelEditor.style.display = 'inline-block';
				save.style.display = 'inline-block';
				back.style.display="inline-block";
				backLE.style.display="inline-block";``
                        for (let i = 0; i < 1280; i += 64) {
                              ctx_uiLE.beginPath();
                              ctx_uiLE.moveTo(i, 0)
                              ctx_uiLE.lineTo(i, 720);
                              ctx_uiLE.stroke();
                        }
                        for (let i = 0; i < 720; i+= 64) {
                              ctx_uiLE.beginPath();
                              ctx_uiLE.moveTo(0, i);
                              ctx_uiLE.lineTo(1280, i);
                              ctx_uiLE.stroke();
                        }


			//play.style.display="inline-block";
			 screen='le';
		 	console.log(screen);
      }

      // <!--  drawing to canvus and moving -->

      //let ctx = document.getElementById('ctx').getContext('2d');

      // let player = {
      //       x:50,
      //       y:50,
      // };
    player = Player(190, 620);
	mousePos=MousePos(0,0,'p');
      //var img = new Image()

      // img.onload = function() {
      //
      //
      //     ctx.drawImage(img, 0, 0);
      //
      // };

      //img.src = "img/Armature_Idle_12.png";

	//if(gameDiv.style.display!="none"){
       setInterval(update, 30);
	//}

      //ctx.fillRect(Player.x, player.y, 20, 20);

</script>
</body>
<!-- <style>
      selections {
            position: absolute;
            right: 1290px;

      }
</style> -->
</HTML>
