<!-- levelEditor button does not work for some reason -->
<!DOCTYPE HTML>
<HTML>
<!-- <head>
      <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <script  async src="js/entity.js"></script>
      <script type="text/javascript;charset=utf-8" async src="js/inventory.js"></script>
</head> -->
<script src="js/entity.js"></script>
<script src="js/levelEditor.js"></script>
<script src="js/levelLoad.js"></script>
<script src="js/levelSave.js"></script>
<script src="js/inventory.js"></script>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<body>
<div id="signDiv">
	Username: <input id="signDiv-username" type="text"></input><br>
	Password: <input id="signDiv-password" type="password"></input>
	<button id="signDiv-signIn">Sign In</button>
	<button id="signDiv-signUp">Sign Up</button>
</div>

<div id="gameDiv" style="display:none;">
	<div id="game" style="position:absolute;width:1280px;height:720px">
		<canvas id="ctx" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>
		<canvas id="ctx-ui" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>
	</div>
</div>

<div id="levelEditor" style="display:none;">
	<div id="editor" style="position:absolute;width:1280px;height:720px; overflow: scroll;">
		<canvas id="ctxLE" width="3000" height="720" style="position:absolute;border:1px solid #000000;"></canvas>
		<canvas id="ctx-uiLE" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>
	</div>
      <div id="aSelect1" style ="position: fixed; bottom: 1280; right: 0;">
            <select id="selections";>
                  <option value="p"selected="selected">Player</option>
                  <option value="e">Enemies</option>
                  <option value="f">Platform</option>
            </select>
      </div>
	<div id="backLE" style="display:none;position:absolute;top:750px;">
		<button onclick="backMainMenu()">Back</button>
	</div>
	<div id="save" style ="display:none;position:absolute;top:750px;left:50px">
      <button onclick="saveEdit()">Save</button>
	</div>
	<div id="play" style="display:none;position:absolute;top:750px;left:100px;">
		<button id="play">Play</button>
	</div>
</div>

<div id="playerProfile" style ="display:none;">
	 UserName : <input type="text" id="username" value=username>
	 token : <input type="text" id="token" value=token>

</div>


<div id="back" style ="display:none;">
      <button onclick="backMainMenu()">Back</button>
</div>




<div id="profileDiv" style ="display:none;">
      <button onclick="showProfile()">Profile</button>
</div>


<!-- <div id="selections" style ="display:none;">
      <select>
            <option value="asset1">asset1</option>
            <option value="asset2">asset2</option>
            <option value="asset3">asset3</option>
      </select>
</div> -->


<div id="mainMenu" style="display:none;">
			<button id="profile">Profile </button>
			<button id="newGame">New Game</button>
			<button id="loadGame">Load Game</button>
      <button id="levelEditorB">Level Editor</button>
</div>
<!-- All files had the same id
      Will need to connect to database -->
<div id="loadFile" style="display:none;">
      <button id="file">File One</button>
      <button id="file">File Two</button>
      <button id="file">File Three</button>
</div>

<script>
	var username = "";
	var token = "";
	let canvas=document.getElementById('ctx');
	let ctx=canvas.getContext('2d');
	let canvasLE=document.getElementById('ctxLE');
	let ctxLE=canvasLE.getContext('2d');

  let signDivSignIn = document.getElementById('signDiv-signIn');
  let signDivSignUp = document.getElementById('signDiv-signUp');
  let newGame = document.getElementById('newGame');
  let loadGame = document.getElementById('loadGame');
  let levelEditorB = document.getElementById('levelEditorB');
  let loadFile = document.getElementById('loadFile');
  let file = document.getElementById('file');
  let a1 = document.getElementById('selections');

   
	let save = document.getElementById('save');
	let usernameText=document.getElementById('username');
	let profile=document.getElementById('profile');
	let tokenText=document.getElementById('token');
	let keyUp=87;
	let keyDown=83;
	let keyRight=68;
	let keyLeft=65;
	let keyPause=80;
	let keyGrapple=32;
	let keyChange=67;
	let W=1280;
	let H=720;
	let screen='sign';
	let count=0;


    var Img = {};
    Img.playerLevel = new Image();
    Img.playerLevel.src = "img/player_level.png";
	Img.penLeft=new Image();
	Img.penLeft.src="img/pen_left.png";
	Img.penRight=new Image();
	Img.penRight.src="img/pen_right.png";
	Img.philEnemy=new Image();
	Img.philEnemy.src="img/philEnemy.png";

	//testing collision of rectangles
	testCollisionRects = function(rect1,rect2){
	return rect1.x <= rect2.x+rect2.width
		&& rect2.x <= rect1.x+rect1.width
		&& rect1.y <= rect2.y + rect2.height
		&& rect2.y <= rect1.y + rect1.height;
	}

	//action listeners, logic tbd
	document.onmousedown=function(mouse){
		if(mouse.which==1){
			if (levelEditor.style.display == "none") {
				player.lMouseClick=true;
			}
			else{
				let selection = selections.options[selections.selectedIndex].value;
				mousePos.code=selection;
				console.log(mousePos.code);
				mousePos.draw();
			}
		}
		else{
			player.rMouseClick=true;
		}
	}
	document.onmouseup=function(mouse){
		if(mouse.which==1){
			player.lMouseClick=false;
		}
		else{
			player.rMouseClick=false;
		}
	}
	document.oncontextmenu=function(mouse){
		mouse.preventDefault();
	}
	document.onmousemove=function(mouse){
	let mouseX = mouse.clientX - canvas.getBoundingClientRect().left;
	let mouseY = mouse.clientY - canvas.getBoundingClientRect().top;



      if (levelEditor.style.display == "none") {
            mouseX -= W/2;
			mouseY -= H/2;
            player.aimAngle = Math.atan2(mouseY,mouseX) / Math.PI * 180;
      }
      else {
            mousePos.x=mouseX-8;
			mousePos.y=mouseY-22;
            // console.log("mouseX: " + mouseX + "mouseY: " + mouseY);
      }

	}
	document.onkeydown=function(event){
		if(screen=='game'){
			if(event.keyCode==keyUp) {
				player.upPress=true;
				}
			else if(event.keyCode==keyDown) {
				player.downPress=true;
				}
			else if(event.keyCode==keyRight){
				player.rightPress=true;
				}
			else if(event.keyCode==keyLeft) {
				player.leftPress=true;
			}
			else if(event.keyCode==keyPause) {
				//add logic to pause
            }
			else if(event.keyCode==keyGrapple) {
				player.grapplePress=true;
            }
			else if(event.keyCode==keyChange){
				if(player.weap==0){
					player.weap=1;
				}
				else{
					player.weap=0;
				}
			}
		}
	}
	document.onkeyup=function(event){
		if(event.keyCode==keyUp)
			player.upPress=false;
		else if(event.keyCode==keyDown)
			player.downPress=false;
		else if(event.keyCode==keyRight)
			player.rightPress=false;
		else if(event.keyCode==keyLeft)
			player.leftPress=false;
		else if(event.keyCode==keyPause) {
			//add logic to pause
            }
		else if(event.keyCode==keyGrapple)
			player.grapplePress=false;
	}

	//update for in game, logic tbd
	update=function(){
			if(levelEditor.style.display == "none"){
				ctx.clearRect(0, 0, 1280, 720);
			}
			else{
				ctxLE.clearRect(0,0,1280,720);
			}
            player.update();
			Enemy.update();
			Projectile.update();
			Platform.update();
            //console.log("Player (X,Y): " + "(" + player.x + ", " + player.y + ")");
			//console.log("Player aim angle is: "+player.aimAngle);
			//console.log("Grapple key = "+player.grapplePress);
			//console.log("Attack Speed: "+player.atkSpd+" Attack Counter: "+player.atkCnt);
      }

    function valid(userName,pass){
			if (!isEmpty(userName) && !isEmpty(pass) ){
					return true;
				}

			}
	function isEmpty(str) {
		return (!str || 0 === str.length);
	}


	signDivSignUp.onclick = function() {
		user=document.getElementById('signDiv-username').value;
		pass=document.getElementById('signDiv-password').value;

		if (valid(user,pass)){
			var socket = io();
			socket.emit('signUp',{
			username:user, password:pass ,
			});

			socket.on('accountCreated', function(message){
				console.log(message);

				if (message.accountCreated==true){

			//	console.log("welcome "  +message["token"]);



			//	var x={"key":value , "key2" :value};
			//	console.log("foo "  + x[0]);



				 console.log("account Created");

				}
			});

		}

    }



	signDivSignIn.onclick = function() {
            console.log("signDivSignIn HIT")
			user=document.getElementById('signDiv-username').value;
			pass=document.getElementById('signDiv-password').value;

			screen='menu';
			signDiv.style.display = 'none';


			mainMenu.style.display = 'inline-block';
			back.style.display = 'inline';


			if (valid(user,pass)){

				var socket = io();

				socket.emit('signIn',{
				username:user, password:pass ,

				});

				socket.on('signedIn', function(message){            //AccountManager
					console.log(message);

					msg=message;
					token = message.token;


					console.log(message.signedIn);
					if (message.signedIn==true){


					username=message.userName;
					token=message.token;
					tokenText.value=token;
					usernameText.value=username;



					console.log("welcome  : "  +message.userName  ) ;
					console.log("your token is  :"  +message.token);



					document.getElementById('signDiv-password').value;
					signDiv.style.display = 'none';
					mainMenu.style.display = 'inline-block';
					//playerProfile.style.display = 'inline-block';
					back.style.display = 'inline';

					count=1;

				}


				});

				}

				count=1;

	}

	function backMainMenu(){
		if (count==1){
			mainMenu.style.display = 'none';
			back.style.display = 'none';
			backLE.style.display = 'none';
			playerProfile.style.display = 'none';
			 signDiv.style.display = 'inline-block';
			 count=0;

		}

		else{
			levelEditor.style.display = 'none';
            selections.style.display = 'none';
			loadFile.style.display = 'none';
			gameDiv.style.display = 'none';

			back.style.display = 'none';

			//gameDiv.style.display = 'inline-block';
            mainMenu.style.display = 'inline-block';
			back.style.display = 'inline';
			count=1;
		}
			//console.log("count " + count);


	}


	function saveEdit(){

		var socket = io();

		socket.on('saveLevel', function(message){
				save:saveLevel(0,0,0,0)


		socket.emit('saveLevel',{
				save:saveLevel(0,0,0,0),
				username: username,



				token : token,


				});



});}


	//console.log("string :" + saveLevel(0,0,0,0));

	play.onclick=function(){
		gameDiv.style.display="inline-block";
		levelEditor.style.display = 'none';
		save.style.display = 'none';
		backLE.style.display="none";
		play.style.display="none";
		screen='game';
	}

      newGame.onclick = function() {
        mainMenu.style.display = 'none';
        gameDiv.style.display = 'inline-block';
		screen='game';
		count=2;
		player = Player(190, 620);
		Enemy.generate(0,0,'e');
		Platform.generate(128,128,'f');
            Platform.generate(190,684,'f');
      }

      loadGame.onclick = function() {
            mainMenu.style.display = 'none';
            loadFile.style.display = 'inline-block';
			screen='game';
			count=2;
      }

      file.onclick = function () {
            loadFile.style.display = 'none';
            gameDiv.style.display = 'inline-block';
      }

			profile.onclick= function  () {
            playerProfile.style.display = 'inline-block';
						console.log("profile hit");
      }

      levelEditorB.onclick = function() {
            mainMenu.style.display = 'none';
            selections.style.display = 'inline';
            levelEditor.style.display = 'inline-block';
			save.style.display = 'inline-block';
			back.style.display="none";
			backLE.style.display="inline-block";
			play.style.display="inline-block";
			screen='le';
			console.log(screen);
			count=2;
      }
// mouseX is undefined
      function assets() {
            let selection = selections.options[selections.selectedIndex].value;
            console.log(selection);
            if (selection === "asset1") {
                  //console.log(mousePos.x);
                  ctxLE.fillRect(mousePos.x, mousePos.y, 20,20);
            }
      }

      // <!--  drawing to canvus and moving -->

      //let ctx = document.getElementById('ctx').getContext('2d');

      // let player = {
      //       x:50,
      //       y:50,
      // };
    player = Player(190, 620);
	mousePos=MousePos(0,0,'p');
      //var img = new Image()

      // img.onload = function() {
      //
      //
      //     ctx.drawImage(img, 0, 0);
      //
      // };

      //img.src = "img/Armature_Idle_12.png";

	//if(gameDiv.style.display!="none"){
       setInterval(update, 30);
	//}

      //ctx.fillRect(Player.x, player.y, 20, 20);

</script>
</body>
<!-- <style>
      selections {
            position: absolute;
            right: 1290px;

      }
</style> -->
</HTML>
